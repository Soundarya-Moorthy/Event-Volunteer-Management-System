{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Togetherly Volunteers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
        }
        .events-wrapper {
            padding: 60px 20px;
            max-width: 1200px;
            margin: auto;
        }
        .events-title {
            text-align: center;
            font-size: 2.5rem;
            color: #1e3a8a;
            margin-bottom: 40px;
        }
        .events-scroll {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding-bottom: 20px;
            scroll-snap-type: x mandatory;
        }
        .event-card {
            flex: 0 0 auto;
            scroll-snap-align: start;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            width: 300px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s ease forwards;
            animation-delay: calc(0.2s * var(--i));
        }
        .event-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .event-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .event-card h3 {
            font-size: 1.25rem;
            color: #333;
            margin-bottom: 10px;
        }
        .event-card p {
            font-size: 0.95rem;
            color: #555;
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Registration Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background-color: #fff;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
        }
        th {
            background-color: #1e40af;
            color: white;
        }
        tbody tr:nth-child(even) {
            background-color: #f3f4f6;
        }
        tbody tr:hover {
            background-color: #e0e7ff;
        }
        .section-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 2rem;
        }
        /* Optional: Hide scrollbar for horizontal events */
        .events-scroll::-webkit-scrollbar {
            display: none;
        }
        .events-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 smooth-scroll">

<!-- Header -->
<header class="bg-blue-800 text-white sticky top-0 z-50 shadow-lg">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
        <div class="text-2xl font-bold">Togetherly Volunteers | Admin</div>
        <div class="flex items-center space-x-6">
            <a href="{% url 'index' %}" class="hover:text-blue-300 transition">Home</a>
            <a href="{% url 'admin_dashboard' %}" class="hover:text-blue-300 transition">Dashboard</a>
            <a href="{% url 'login' %}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">Logout</a>
        </div>
    </nav>
</header>

<!-- Home Events Section -->
<section id="events" class="events-wrapper">
    <h2 class="events-title">Manage Home Page Events</h2>
    <div class="events-scroll">
        {% for event in events %}
        <div class="event-card" style="--i: {{ forloop.counter }}">
            {% if event.image %}
                <img src="{{ event.image.url }}" alt="{{ event.title }}">
            {% else %}
                <img src="{% static 'accounts/images/default_event.jpg' %}" alt="Default Event">
            {% endif %}
            <h3>{{ event.title }}</h3>
            <p>{{ event.description|truncatechars:100 }}</p>
            <div class="mt-3 flex justify-around">
                <a href="{% url 'edit_event' event.id %}" class="text-white bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded">Edit</a>
                <a href="{% url 'delete_event' event.id %}" class="text-white bg-red-600 hover:bg-red-700 px-3 py-1 rounded">Delete</a>
            </div>
        </div>
        {% empty %}
        <p>No events available.</p>
        {% endfor %}
    </div>
    <div class="text-center mt-6">
        <a href="{% url 'add_event' %}" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded transition">Add New Event</a>
    </div>
</section>

<!-- Manage AllEvents Section -->
<section id="manage-events" class="events-wrapper">
    <h2 class="section-title">Manage All Events</h2>
    <div class="text-right mb-6">
        <a href="{% url 'add_allevent' %}" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded transition">
            + Add New Event
        </a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for event in allevents %}
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            {% if event.image %}
                <img src="{{ event.image.url }}" alt="{{ event.title }}" class="w-full h-48 object-cover">
            {% else %}
                <img src="{% static 'accounts/images/default_event.jpg' %}" alt="Default Event" class="w-full h-48 object-cover">
            {% endif %}
            <div class="p-6">
                <p class="text-sm text-gray-500 mb-2">üìç {{ event.location }}</p>
                <h3 class="text-xl font-semibold mb-2">{{ event.title }}</h3>
                <p class="text-gray-600 mb-2"><strong>Date:</strong> {{ event.date }} | <strong>Time:</strong> {{ event.time }}</p>
                <ul class="text-sm text-gray-700 mb-4 space-y-1">
                  {% for role in event.role_list %}
                  <li>‚Ä¢ {{ role }}</li>
                  {% endfor %}
                </ul>

                <div class="flex flex-wrap gap-1 mb-3">
                  {% for tag in event.tag_list %}
                  <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">{{ tag }}</span>
                  {% endfor %}
                </div>

                <div class="flex justify-between mt-4">
                    <a href="{% url 'edit_allevent' event.id %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">Edit</a>
                    <a href="{% url 'delete_allevent' event.id %}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">Delete</a>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center col-span-3 text-gray-600">No events available.</p>
        {% endfor %}
    </div>
</section>

<!-- Registrations Section -->
<section id="registrations" class="events-wrapper">
    <h2 class="section-title">Registered Volunteers</h2>
    <div class="overflow-x-auto">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Event</th>
                    <th>Role</th>
                    <th>Registered At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for reg in registrations %}
                <tr>
                    <td>{{ reg.name }}</td>
                    <td>{{ reg.email }}</td>
                    <td>{{ reg.phone }}</td>
                    <td>{{ reg.event.title }}</td>
                    <td>{{ reg.role }}</td>
                    <td>{{ reg.registered_at }}</td>
                    <td>
                      <a href="{% url 'delete_registration' reg.id %}" onclick="return confirm('Are you sure you want to delete this registration?');"
                       class="text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded"> Delete 
                      </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-4">No registrations yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<!-- Active Volunteers Section -->
<section id="active-volunteers" class="py-16 bg-gray-100">
  <div class="container mx-auto px-6">
    <h2 class="text-3xl font-bold text-center text-blue-800 mb-8">Active Volunteers</h2>

    <!-- Search and Filters -->
    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
      <input type="text" id="searchInput" placeholder="Search by name or email" class="w-full md:w-1/3 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
      
      <select id="statusFilter" class="w-full md:w-1/4 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
        <option value="">Filter by Status</option>
        <option value="school">School</option>
        <option value="college">College</option>
        <option value="working">Working</option>
        <option value="other">Other</option>
      </select>

      <select id="experienceFilter" class="w-full md:w-1/4 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
        <option value="">Filter by Experience</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </div>

    <!-- Volunteer Table -->
    <div class="overflow-x-auto bg-white rounded-lg shadow-lg">
      <table class="min-w-full divide-y divide-gray-200" id="volunteerTable">
        <thead class="bg-blue-800 text-white">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Experience</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for v in volunteers %}
          <tr class="volunteer-row" data-name="{{ v.full_name }}" data-email="{{ v.email }}" data-status="{{ v.current_status }}" data-experience="{{ v.has_experience|yesno:'yes,no' }}">
            <td class="px-6 py-4 whitespace-nowrap">{{ v.full_name }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ v.email }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ v.current_status }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              {% if v.has_experience %}
                <span class="inline-block px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full">Yes</span>
              {% else %}
                <span class="inline-block px-3 py-1 text-sm font-medium bg-red-100 text-red-800 rounded-full">No</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <button type="button" class="text-blue-600 hover:underline view-details-btn"
                data-name="{{ v.full_name|escapejs }}"
                data-email="{{ v.email|escapejs }}"
                data-phone="{{ v.phone|escapejs }}"
                data-dob="{{ v.dob|date:'Y-m-d'}}"
                data-gender="{{ v.gender|escapejs }}"
                data-address="{{ v.address|escapejs }}"
                data-languages="{{ v.languages|escapejs }}"
                data-status="{{ v.current_status|escapejs }}"
                data-days="{{ v.preferred_days|escapejs }}"
                data-slots="{{ v.preferred_time_slots|escapejs }}"
                data-dates="{{ v.specific_dates|default_if_none:'' }}"
                data-experience="{{ v.has_experience|yesno:'Yes,No'|escapejs }}"
                data-experience-details="{{ v.experience_details|default_if_none:''|escapejs }}">
                View Details
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div id="detailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg max-w-md w-full shadow-lg">
      <h3 class="text-xl font-bold mb-4">Volunteer Details</h3>
      <div id="modalContent" class="space-y-2 text-gray-700"></div>
      <button onclick="closeModal()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Close</button>
    </div>
  </div>

<!-- Contact Messages Section -->
<section id="contact-messages" class="py-16 bg-white">
  <div class="container mx-auto px-6">
    <h2 class="text-3xl font-bold text-center text-blue-800 mb-8">Contact Messages</h2>

    <div class="overflow-x-auto bg-white rounded-lg shadow-lg">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-blue-800 text-white">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Message</th>
            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Submitted At</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for msg in messages %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ msg.name }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ msg.email }}</td>
            <td class="px-6 py-4 whitespace-normal text-gray-700 max-w-md">{{ msg.message }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-600">{{ msg.submitted_at|date:"Y-m-d H:i" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="px-6 py-4 text-center text-gray-500">No messages submitted yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
  function openModal(name, email, phone, dob, gender, address, languages, status, days, slots, dates, experience, experienceDetails) {
    const modal = document.getElementById('detailsModal');
    const content = document.getElementById('modalContent');

    content.innerHTML = `
      <p><strong>Name:</strong> ${name}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Phone:</strong> ${phone}</p>
      <p><strong>Date of Birth:</strong> ${dob}</p>
      <p><strong>Gender:</strong> ${gender}</p>
      <p><strong>Address:</strong> ${address}</p>
      <p><strong>Languages Known:</strong> ${languages}</p>
      <p><strong>Status:</strong> ${status}</p>
      <p><strong>Preferred Days:</strong> ${days}</p>
      <p><strong>Preferred Time Slots:</strong> ${slots}</p>
      <p><strong>Specific Dates:</strong> ${dates}</p>
      <p><strong>Has Experience:</strong> ${experience}</p>
      <p><strong>Experience Details:</strong> ${experienceDetails || 'None provided'}</p>
    `;

    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeModal() {
    const modal = document.getElementById('detailsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }
</script>

<script>
  // Attach handlers to buttons that hold volunteer data in data-* attributes
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.view-details-btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        const d = btn.dataset;
        openModal(
          d.name || '',
          d.email || '',
          d.phone || '',
          d.dob || '',
          d.gender || '',
          d.address || '',
          d.languages || '',
          d.status || '',
          d.days || '',
          d.slots || '',
          d.dates || '',
          d.experience || '',
          d.experienceDetails || ''
        );
      });
    });
  });
</script>

</body>
</html>
